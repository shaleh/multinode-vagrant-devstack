---
- name: checkout devstack
  git:
  args:
    repo: "{{ devstack_repo }}"
    dest: /home/vagrant/devstack
    version: "{{ version }}"
    accept_hostkey: yes

- name: local.conf
  template: src=local.conf.j2 dest=/home/vagrant/devstack/local.conf

- name: source openrc in profile
  lineinfile:
  args:
    dest: /home/vagrant/.profile
    regexp: ".*openrc"
    line: '. /home/vagrant/devstack/openrc'

- name: run devstack
  shell: ./stack.sh >> /home/vagrant/stack.sh.log 2>&1
  args:
    chdir: /home/vagrant/devstack
    creates: /home/vagrant/devstack/stack-screenrc
